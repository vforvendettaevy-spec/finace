<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Financier - LUKA</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
      padding: 20px; min-height: 100vh;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    .config-banner {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      color: white; padding: 20px; border-radius: 16px; margin-bottom: 20px; text-align: center;
    }
    .config-banner input {
      padding: 12px; border-radius: 8px; border: none; width: 500px; max-width: 90%;
      margin: 10px 0; font-size: 14px;
    }
    .config-banner button {
      background: white; color: #ff6b6b; border: none; padding: 12px 30px;
      border-radius: 8px; font-weight: 600; cursor: pointer; margin-left: 10px;
      transition: transform 0.2s;
    }
    .config-banner button:hover { transform: scale(1.05); }
    .header {
      background: linear-gradient(135deg, #39b46e 0%, #2d8f57 100%);
      color: white; padding: 30px; border-radius: 20px; margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(57, 180, 110, 0.3);
    }
    .header h1 { font-size: 32px; margin-bottom: 10px; }
    .header p { opacity: 0.9; font-size: 16px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px; margin-bottom: 30px; }
    .card {
      background: white; border-radius: 16px; padding: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover { transform: translateY(-5px); box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12); }
    .card-title { font-size: 18px; font-weight: 600; color: #2d3748; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
    .big-number { font-size: 36px; font-weight: 700; color: #39b46e; margin: 10px 0; }
    .subtitle { color: #718096; font-size: 14px; }
    .progress-bar { background: #e2e8f0; height: 30px; border-radius: 15px; overflow: hidden; margin: 15px 0; }
    .progress-fill { background: linear-gradient(90deg, #39b46e 0%, #2d8f57 100%);
      height: 100%; transition: width 0.5s ease; display: flex;
      align-items: center; justify-content: flex-end; padding-right: 15px;
      color: white; font-weight: 600; font-size: 14px; }
    .chart-container {
      background: white; border-radius: 16px; padding: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); margin-bottom: 30px;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 15px; text-align: left; border-bottom: 1px solid #e2e8f0; }
    th { background: #f7fafc; color: #2d3748; font-weight: 600; font-size: 14px; }
    td { color: #4a5568; }
    .positive { color: #39b46e; font-weight: 600; }
    .negative { color: #e53e3e; font-weight: 600; }
    .tab-container { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .tab {
      padding: 12px 24px; background: white; border: none; border-radius: 8px;
      cursor: pointer; font-weight: 600; color: #718096;
      transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .tab.active { background: linear-gradient(135deg, #39b46e 0%, #2d8f57 100%); color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .loading { text-align: center; padding: 40px; color: #718096; }
    #addRowForm input, #addRowForm button {
      margin: 5px 0; padding: 10px; border-radius: 6px; border: 1px solid #ccc; width: 100%;
    }
    #addRowForm button { background: #39b46e; color: white; font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Configuration -->
    <div class="config-banner" id="configBanner">
      <h3>‚öôÔ∏è Configuration Google Sheets</h3>
      <p style="margin: 10px 0; opacity: 0.9;">Colle l'URL de ton Google Sheets ci-dessous</p>
      <input type="text" id="sheetsUrl" placeholder="https://docs.google.com/spreadsheets/d/TON_ID/edit...">
      <button onclick="sauvegarderConfig()">üíæ Enregistrer et charger</button>
      <p style="font-size: 12px; margin-top: 10px; opacity: 0.8;">‚ö†Ô∏è Assure-toi que ton Sheets est en mode "Accessible √† tous"</p>
    </div>

    <!-- Header -->
    <div class="header">
      <h1>üìä Dashboard Financier</h1>
      <p>Suivi de patrimoine - Objectif 1M‚Ç¨ √† 45 ans</p>
    </div>

    <div id="mainContent" style="display: none;">
      <!-- Onglets -->
      <div class="tab-container">
        <button class="tab active" onclick="switchTab('pea')">üíπ PEA - Investissements</button>
        <button class="tab" onclick="switchTab('mensuel')">üí∏ Suivi Mensuel</button>
        <button class="tab" onclick="switchTab('projection')">üîÆ Projection Long Terme</button>
      </div>

      <!-- Contenu Mensuel -->
      <div id="mensuel" class="tab-content active">
        <div class="chart-container">
          <h3 class="card-title">Suivi mensuel des finances</h3>
          <div id="mensuelContent" class="loading">Chargement...</div>
        </div>

        <!-- Formulaire d'ajout -->
        <div class="chart-container">
          <h3 class="card-title">‚ûï Ajouter une ligne dans Budget Mensuel</h3>
          <form id="addRowForm">
            <input type="text" id="mois" placeholder="Mois (ex: Janvier)" required>
            <input type="number" id="revenus" placeholder="Revenus" required>
            <input type="number" id="depenses" placeholder="D√©penses" required>
            <input type="number" id="epargne" placeholder="√âpargne" required>
            <input type="number" id="investissements" placeholder="Investissements" required>
            <input type="number" step="0.01" id="taux" placeholder="Taux (0.25 pour 25%)" required>
            <input type="text" id="commentaire" placeholder="Commentaire">
            <button type="submit">üíæ Enregistrer</button>
          </form>
          <div id="formMessage"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let spreadsheetId = null;
    let sheetsData = {};
    const apiUrl = "TON_URL_APPS_SCRIPT"; //https://script.google.com/macros/s/AKfycbwpDncmAIyZk9FXOB3B0JVWHXXG3kMF-0XeN3NM2z6os-jzL-agSFO49yOJJfdqe9QDmg/exec

    // ‚úÖ Formulaire d'ajout de donn√©es
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("addRowForm");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const data = {
          mois: document.getElementById("mois").value,
          revenus: parseFloat(document.getElementById("revenus").value),
          depenses: parseFloat(document.getElementById("depenses").value),
          epargne: parseFloat(document.getElementById("epargne").value),
          investissements: parseFloat(document.getElementById("investissements").value),
          taux: parseFloat(document.getElementById("taux").value),
          commentaire: document.getElementById("commentaire").value
        };
        try {
          const response = await fetch(apiUrl, {
            method: "POST",
            body: JSON.stringify(data),
            headers: { "Content-Type": "application/json" }
          });
          const result = await response.json();
          if (result.result === "success") {
            document.getElementById("formMessage").innerText = "‚úÖ Donn√©es ajout√©es avec succ√®s !";
            form.reset();
          } else {
            document.getElementById("formMessage").innerText = "‚ùå Erreur lors de l‚Äôajout";
          }
        } catch (err) {
          document.getElementById("formMessage").innerText = "‚ö†Ô∏è Erreur : " + err.message;
        }
      });
    });

    // Navigation onglets
    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById(tab).classList.add('active');
    }
  </script>
</body>
</html>
