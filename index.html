<!DOCTYPE html> <html lang="fr"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width,initial-scale=1" /> <title>Dashboard PEA - LUKA_INVEST_PRO</title> <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ“Š</text></svg>" /> <style> /* Styles inspirÃ©s de ton design : vert/violet, gros format lisible - MODE SOMBRE */ *{box-sizing:border-box} body{   font-family: "Segoe UI", Roboto, Arial, sans-serif;   background: linear-gradient(135deg,#0a0e14 0%,#1a1f2e 100%);   margin:0;padding:22px;color:#e2e8f0; } .container{max-width:1400px;margin:0 auto;} .header{   background:linear-gradient(135deg,#39b46e 0%,#2d8f57 100%);   color:#fff;padding:36px;border-radius:18px;margin-bottom:26px;   box-shadow:0 10px 40px rgba(57,180,110,0.18);text-align:center; } .header h1{font-size:34px;margin-bottom:6px} .header p{opacity:.95;font-size:16px} .params-section{   background:#1e2433;border-radius:14px;padding:26px;margin-bottom:22px;   box-shadow:0 6px 20px rgba(0,0,0,0.4);border:1px solid #2d3748; } .params-title{font-size:20px;font-weight:700;color:#e2e8f0;margin-bottom:16px;display:flex;gap:10px;align-items:center} .params-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px} .param-item{background:#2d3748;padding:14px;border-radius:10px;border:1px solid #374151;transition:all .18s} .param-item:hover{transform:translateY(-3px);border-color:#39b46e;} .param-item label{display:block;font-weight:600;color:#cbd5e0;margin-bottom:8px} .param-item input{width:100%;padding:10px;border-radius:8px;border:1px solid #4a5568;font-size:15px;background:#1a202c;color:#e2e8f0} .btn-primary{background:linear-gradient(135deg,#39b46e 0%,#2d8f57 100%);color:#fff;border:none;padding:12px 28px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(57,180,110,.18);transition:transform .2s} .btn-primary:hover{transform:translateY(-3px)} .btn-primary:active{transform:translateY(0)} .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;margin:20px 0} .stat-card{background:#1e2433;padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.4);border:1px solid #2d3748} .stat-label{font-size:13px;color:#9ca3af;margin-bottom:8px} .stat-value{font-size:30px;font-weight:800;color:#e2e8f0} .progress-bar{background:#2d3748;height:32px;border-radius:18px;overflow:hidden;margin-top:12px} .progress-fill{height:100%;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;background:linear-gradient(90deg,#39b46e,#2d8f57);transition:width .5s} .chart-section{background:#1e2433;border-radius:14px;padding:22px;margin-bottom:22px;box-shadow:0 6px 20px rgba(0,0,0,0.4);border:1px solid #2d3748} .section-title{font-size:18px;font-weight:800;color:#e2e8f0;margin-bottom:14px} .table-controls{display:grid;grid-template-columns:200px 160px 120px;gap:10px;margin-bottom:12px} .table-controls input[type="date"], .table-controls input[type="number"]{   padding:10px;   border-radius:8px;   border:1px solid #4a5568;   background:#2d3748;   color:#e2e8f0;   font-size:15px; } .btn-add{background:linear-gradient(135deg,#7a6ff0,#6355cc);color:#fff;padding:10px;border-radius:8px;border:none;font-weight:700;cursor:pointer} .btn-delete{background:#e53e3e;color:#fff;border:none;padding:8px 10px;border-radius:6px;cursor:pointer} table{width:100%;border-collapse:collapse;margin-top:10px} th,td{padding:12px;text-align:left;border-bottom:1px solid #374151;color:#e2e8f0} th{background:#2d3748;color:#cbd5e0;font-weight:700;font-size:13px} .positive{color:#39b46e;font-weight:800} .projection-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:14px;margin-top:10px} .projection-card{background:linear-gradient(135deg,#7a6ff0 0%,#6355cc 100%);color:#fff;padding:16px;border-radius:10px;text-align:center} .projection-age{font-size:20px;font-weight:800} .projection-amount{font-size:15px;opacity:.95} .pie-container{   display:flex;   justify-content:center;   align-items:center;   gap:40px;   flex-wrap:wrap;   margin-top:20px; } .pie-chart{   position:relative; } .pie-legend{   display:flex;   flex-direction:column;   gap:12px; } .legend-item{   display:flex;   align-items:center;   gap:10px;   font-size:15px; } .legend-color{   width:24px;   height:24px;   border-radius:4px; } .legend-label{   color:#cbd5e0; } .legend-value{   color:#e2e8f0;   font-weight:700;   margin-left:auto; } @media (max-width:720px){   .table-controls{grid-template-columns:1fr 1fr}   .pie-container{flex-direction:column;} } </style> </head> <body> <div class="container">   <div class="header">     <h1>ğŸ¯ Mon Dashboard PEA</h1>     <p>Objectif : 1 000 000 â‚¬ Ã  45 ans Â· LUKA_INVEST_PRO</p>   </div>    <div class="params-section">     <div class="params-title">âš™ï¸ Mes paramÃ¨tres</div>     <div class="params-grid">       <div class="param-item">         <label>ğŸ’° Revenu mensuel (â‚¬)</label>         <input id="revenu" type="number" value="1200" min="0" />       </div>       <div class="param-item">         <label>ğŸ“ˆ Investissement mensuel (â‚¬)</label>         <input id="investissement" type="number" value="900" min="0" />       </div>       <div class="param-item">         <label>ğŸŒ MSCI World (%)</label>         <input id="msciWorld" type="number" value="85" min="0" max="100" />       </div>       <div class="param-item">         <label>ğŸŒ MarchÃ©s Ã©mergents (%)</label>         <input id="msciEM" type="number" value="15" min="0" max="100" />       </div>       <div class="param-item">         <label>ğŸ“Š Rendement annuel (%)</label>         <input id="rendement" type="number" value="7" step="0.1" min="0" />       </div>       <div class="param-item">         <label>ğŸ’¸ Frais de courtage (%)</label>         <input id="fraisCourtage" type="number" value="0.2" step="0.1" min="0" />       </div>       <div class="param-item">         <label>ğŸ‚ Mon Ã¢ge actuel</label>         <input id="age" type="number" value="17" min="0" />       </div>       <div class="param-item">         <label>ğŸ’š Livret A (â‚¬)</label>         <input id="livretA" type="number" value="3000" min="0" />       </div>       <div class="param-item">         <label>ğŸ’³ Compte courant (â‚¬)</label>         <input id="compteCourant" type="number" value="0" min="0" />       </div>     </div>     <div style="text-align:center;margin-top:16px">       <button class="btn-primary" id="btnCalculer">ğŸš€ Calculer ma projection</button>     </div>   </div>    <div class="stats-grid">     <div class="stat-card">       <div class="stat-label">ğŸ’° Capital total estimÃ©</div>       <div class="stat-value" id="capitalTotal">0 â‚¬</div>     </div>     <div class="stat-card">       <div class="stat-label">ğŸ“ˆ Valeur PEA</div>       <div class="stat-value" id="valeurPEA">0 â‚¬</div>     </div>     <div class="stat-card">       <div class="stat-label">ğŸ“ˆ Plus-value PEA</div>       <div id="plusValue" style="font-size:28px;font-weight:800;color:#39b46e">+0 â‚¬</div>     </div>     <div class="stat-card">       <div class="stat-label">ğŸ¯ Progression vers 1Mâ‚¬</div>       <div class="stat-value" id="progression">0%</div>       <div class="progress-bar"><div id="progressBar" class="progress-fill" style="width:0%">0%</div></div>     </div>   </div>    <div class="chart-section">     <div class="section-title">ğŸ“Š RÃ©partition de mon patrimoine</div>     <div class="pie-container">       <div class="pie-chart">         <canvas id="pieChart" width="280" height="280"></canvas>       </div>       <div class="pie-legend" id="pieLegend"></div>     </div>   </div>    <!-- NOUVEAU : Graphique d'Ã©volution -->   <div class="chart-section">     <div class="section-title">ğŸ“ˆ Ã‰volution de mon PEA mois par mois</div>     <div style="overflow-x:auto;">       <canvas id="evolutionChart" width="1200" height="400"></canvas>     </div>   </div>    <!-- NOUVEAU : Simulateur de scÃ©narios -->   <div class="chart-section">     <div class="section-title">ğŸ² Simulateur de scÃ©narios</div>     <div class="params-grid" style="margin-bottom:20px">       <div class="param-item">         <label>ğŸ’° Versement mensuel simulÃ© (â‚¬)</label>         <input id="simInvest" type="number" value="1200" min="0" />       </div>       <div class="param-item">         <label>ğŸ“Š Rendement annuel simulÃ© (%)</label>         <input id="simRendement" type="number" value="5" step="0.1" min="0" />       </div>       <div class="param-item">         <label>ğŸ¯ Ã‚ge cible</label>         <input id="simAge" type="number" value="45" min="0" />       </div>     </div>     <div style="text-align:center;margin-bottom:20px">       <button class="btn-primary" onclick="simulerScenario()">ğŸ”® Simuler ce scÃ©nario</button>     </div>     <div id="resultatsSimulation" style="display:none">       <div class="stats-grid">         <div class="stat-card">           <div class="stat-label">ğŸ’¼ ScÃ©nario actuel</div>           <div class="stat-value" id="scenarioActuel">0 â‚¬</div>           <div style="font-size:13px;color:#9ca3af;margin-top:8px" id="detailsActuel"></div>         </div>         <div class="stat-card" style="background:linear-gradient(135deg,#7a6ff0 0%,#6355cc 100%);border:2px solid #7a6ff0">           <div class="stat-label" style="color:#fff">ğŸ² Nouveau scÃ©nario</div>           <div class="stat-value" style="color:#fff" id="scenarioSimule">0 â‚¬</div>           <div style="font-size:13px;color:#e9d5ff;margin-top:8px" id="detailsSimule"></div>         </div>         <div class="stat-card">           <div class="stat-label">ğŸ“Š DiffÃ©rence</div>           <div class="stat-value" id="difference">0 â‚¬</div>           <div style="font-size:13px;color:#9ca3af;margin-top:8px" id="detailsDiff"></div>         </div>       </div>     </div>   </div>    <div class="chart-section">     <div class="section-title">ğŸ“… Historique d'investissement</div>     <div class="table-controls">       <input id="nouvelleDate" type="date" />       <input id="nouveauMontant" type="number" placeholder="Montant (â‚¬)" value="900" />       <button class="btn-add" onclick="ajouterMois()">â• Ajouter</button>     </div>      <table>       <thead>         <tr>           <th>ğŸ“… Date</th>           <th>ğŸ’° Versement</th>           <th>ğŸŒ MSCI World</th>           <th>ğŸŒ Ã‰mergents</th>           <th>ğŸ“ˆ Valeur cumulÃ©e</th>           <th>ğŸ’¹ Plus-value</th>           <th>ğŸ—‘ï¸</th>         </tr>       </thead>       <tbody id="historique"></tbody>     </table>   </div>    <div class="chart-section">     <div class="section-title">ğŸ“Š Projection dÃ©taillÃ©e par Ã¢ge</div>     <table id="tableProjection">       <thead>         <tr>           <th>ğŸ‚ Ã‚ge</th>           <th>â±ï¸ AnnÃ©es</th>           <th>ğŸ’° Total versÃ© (est.)</th>           <th>ğŸ“ˆ Capital estimÃ©</th>           <th>ğŸ’¹ Plus-value</th>         </tr>       </thead>       <tbody id="projectionBody"></tbody>     </table>   </div>    <div class="chart-section">     <div class="section-title">ğŸ”® Ma projection jusqu'Ã  45 ans</div>     <div id="projectionGrid" class="projection-grid"></div>   </div> </div>  <script> /* Dashboard JS complet */ let historiqueMois = [];  window.onload = function() {   // restore saved data   try {     const saved = localStorage.getItem('dashboardData');     if (saved) {       const data = JSON.parse(saved);       document.getElementById('revenu').value = data.revenu ?? 1200;       document.getElementById('investissement').value = data.investissement ?? 900;       document.getElementById('msciWorld').value = data.msciWorld ?? 85;       document.getElementById('msciEM').value = data.msciEM ?? 15;       document.getElementById('rendement').value = data.rendement ?? 7;       document.getElementById('age').value = data.age ?? 17;       document.getElementById('livretA').value = data.livretA ?? 3000;       document.getElementById('compteCourant').value = data.compteCourant ?? 0;       // rebuild historique avec gestion de la date       historiqueMois = (data.historique || []).map(item => {         return {           date: item.date || item.mois, // CompatibilitÃ© ancien format           montant: Number(item.montant) || 0,           world: Number(item.world) || 0,           em: Number(item.em) || 0,           id: Number(item.id) || Date.now() + Math.floor(Math.random()*1000)         };       });       historiqueMois.sort((a,b) => new Date(a.date) - new Date(b.date));     }   } catch(e) {     console.warn('Erreur lecture storage', e);     historiqueMois = [];   }      // Attacher l'Ã©vÃ©nement au bouton   document.getElementById('btnCalculer').addEventListener('click', calculer);      // Calculer au chargement   calculer(); };  function sauvegarder() {   try {     const data = {       revenu: Number(document.getElementById('revenu').value) || 0,       investissement: Number(document.getElementById('investissement').value) || 0,       msciWorld: Number(document.getElementById('msciWorld').value) || 85,       msciEM: Number(document.getElementById('msciEM').value) || 15,       rendement: Number(document.getElementById('rendement').value) || 7,       age: Number(document.getElementById('age').value) || 17,       livretA: Number(document.getElementById('livretA').value) || 0,       compteCourant: Number(document.getElementById('compteCourant').value) || 0,       historique: historiqueMois.map(h => ({         date: h.date,         montant: h.montant,         world: h.world,         em: h.em,         id: h.id       }))     };     localStorage.setItem('dashboardData', JSON.stringify(data));   } catch(e) {     console.warn('Erreur sauvegarde', e);   } }  function calculer() {   console.log('Calcul en cours...');      const livretA = Number(document.getElementById('livretA').value) || 0;   const compteCourant = Number(document.getElementById('compteCourant').value) || 0;   const rendementAnn = Number(document.getElementById('rendement').value) || 7;   const rendement = rendementAnn / 100;   const age = Number(document.getElementById('age').value) || 17;   const investissement = Number(document.getElementById('investissement').value) || 0;    const today = new Date();   let valeurPEA = 0;   let totalVerse = 0;   let totalWorld = 0;   let totalEM = 0;    historiqueMois.sort((a,b) => new Date(a.date) - new Date(b.date));    historiqueMois.forEach(item => {     const depDate = new Date(item.date);     let monthsElapsed = (today.getFullYear() - depDate.getFullYear()) * 12 + (today.getMonth() - depDate.getMonth());     if (monthsElapsed < 0) monthsElapsed = 0;     const monthlyRate = rendement / 12;     const value = item.montant * Math.pow(1 + monthlyRate, monthsElapsed);     valeurPEA += value;     totalVerse += item.montant;     totalWorld += item.world;     totalEM += item.em;   });    const plusValue = valeurPEA - totalVerse;   const capitalTotal = livretA + compteCourant + valeurPEA;    const progressionPct = (capitalTotal / 1000000 * 100);   const progressionPctText = progressionPct.toFixed(2);    console.log('Plus-value calculÃ©e:', plusValue);   console.log('Valeur PEA:', valeurPEA);   console.log('Total versÃ©:', totalVerse);    document.getElementById('capitalTotal').textContent = formatEuro(capitalTotal);   document.getElementById('valeurPEA').textContent = formatEuro(valeurPEA);      // Affichage de la plus-value   const plusValueElement = document.getElementById('plusValue');   const plusValueText = (plusValue >= 0 ? '+ ' : '- ') + formatEuro(Math.abs(plusValue));   plusValueElement.textContent = plusValueText;   plusValueElement.style.color = plusValue >= 0 ? '#39b46e' : '#e53e3e';      console.log('Plus-value affichÃ©e:', plusValueText);      document.getElementById('progression').textContent = progressionPctText + '%';   const width = Math.min(Math.max(progressionPct, 0), 100);   const bar = document.getElementById('progressBar');   bar.style.width = width + '%';   bar.textContent = progressionPctText + '%';    dessinerGraphique(totalWorld, totalEM, livretA, compteCourant);   dessinerGraphiqueEvolution();   afficherHistorique();   afficherProjection(capitalTotal, investissement, rendement, age);   sauvegarder();      console.log('Calcul terminÃ©!'); }  function dessinerGraphique(world, em, livret, courant) {   const canvas = document.getElementById('pieChart');   const ctx = canvas.getContext('2d');   const legend = document.getElementById('pieLegend');      const total = world + em + livret + courant;      if (total === 0) {     ctx.clearRect(0, 0, canvas.width, canvas.height);     ctx.fillStyle = '#9ca3af';     ctx.font = '16px sans-serif';     ctx.textAlign = 'center';     ctx.fillText('Aucune donnÃ©e', canvas.width / 2, canvas.height / 2);     legend.innerHTML = '<div style="color:#9ca3af;font-size:14px;">Commence Ã  investir !</div>';     return;   }    const data = [     { label: 'ğŸŒ MSCI World', value: world, color: '#39b46e' },     { label: 'ğŸŒ Ã‰mergents', value: em, color: '#7a6ff0' },     { label: 'ğŸ’š Livret A', value: livret, color: '#48bb78' },     { label: 'ğŸ’³ Compte courant', value: courant, color: '#4299e1' }   ].filter(item => item.value > 0);    ctx.clearRect(0, 0, canvas.width, canvas.height);      const centerX = canvas.width / 2;   const centerY = canvas.height / 2;   const radius = 110;      let currentAngle = -Math.PI / 2;      data.forEach(item => {     const sliceAngle = (item.value / total) * 2 * Math.PI;          // Dessiner la part     ctx.beginPath();     ctx.fillStyle = item.color;     ctx.moveTo(centerX, centerY);     ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);     ctx.closePath();     ctx.fill();          // Ajouter le pourcentage sur le graphique     const middleAngle = currentAngle + sliceAngle / 2;     const textX = centerX + Math.cos(middleAngle) * (radius * 0.7);     const textY = centerY + Math.sin(middleAngle) * (radius * 0.7);          const percent = ((item.value / total) * 100).toFixed(1);     ctx.fillStyle = '#ffffff';     ctx.font = 'bold 14px sans-serif';     ctx.textAlign = 'center';     ctx.textBaseline = 'middle';     ctx.fillText(percent + '%', textX, textY);          currentAngle += sliceAngle;   });    // CrÃ©er la lÃ©gende   let legendHtml = '';   data.forEach(item => {     const percent = ((item.value / total) * 100).toFixed(1);     legendHtml += `       <div class="legend-item">         <div class="legend-color" style="background:${item.color}"></div>         <span class="legend-label">${item.label}</span>         <span class="legend-value">${formatEuro(item.value)} (${percent}%)</span>       </div>     `;   });   legend.innerHTML = legendHtml; }  function dessinerGraphiqueEvolution() {   const canvas = document.getElementById('evolutionChart');   const ctx = canvas.getContext('2d');      if (historiqueMois.length === 0) {     ctx.clearRect(0, 0, canvas.width, canvas.height);     ctx.fillStyle = '#9ca3af';     ctx.font = '16px sans-serif';     ctx.textAlign = 'center';     ctx.fillText('Ajoute tes premiers investissements pour voir ton Ã©volution !', canvas.width / 2, canvas.height / 2);     return;   }    const rendement = Number(document.getElementById('rendement').value) / 100 || 0.07;   const today = new Date();      // Calculer les donnÃ©es mois par mois   let dataPoints = [];   let valeurCumulee = 0;   let totalVerse = 0;      historiqueMois.forEach((item) => {     const depDate = new Date(item.date);     let monthsElapsed = (today.getFullYear() - depDate.getFullYear()) * 12 + (today.getMonth() - depDate.getMonth());     if (monthsElapsed < 0) monthsElapsed = 0;     const monthlyRate = rendement / 12;     const valueThis = item.montant * Math.pow(1 + monthlyRate, monthsElapsed);     valeurCumulee += valueThis;     totalVerse += item.montant;          dataPoints.push({       date: depDate,       valeur: valeurCumulee,       verse: totalVerse,       plusValue: valeurCumulee - totalVerse     });   });    // Dimensions du graphique   const padding = 60;   const graphWidth = canvas.width - padding * 2;   const graphHeight = canvas.height - padding * 2;      ctx.clearRect(0, 0, canvas.width, canvas.height);      // Fond   ctx.fillStyle = '#1a202c';   ctx.fillRect(0, 0, canvas.width, canvas.height);      // Trouver min/max   const maxValeur = Math.max(...dataPoints.map(d => d.valeur));   const minDate = dataPoints[0].date.getTime();   const maxDate = dataPoints[dataPoints.length - 1].date.getTime();      // Dessiner les axes   ctx.strokeStyle = '#4a5568';   ctx.lineWidth = 2;   ctx.beginPath();   ctx.moveTo(padding, padding);   ctx.lineTo(padding, canvas.height - padding);   ctx.lineTo(canvas.width - padding, canvas.height - padding);   ctx.stroke();      // Grille horizontale   ctx.strokeStyle = '#2d3748';   ctx.lineWidth = 1;   for (let i = 0; i <= 5; i++) {     const y = padding + (graphHeight / 5) * i;     ctx.beginPath();     ctx.moveTo(padding, y);     ctx.lineTo(canvas.width - padding, y);     ctx.stroke();          // Labels Y     const valeur = maxValeur * (1 - i / 5);     ctx.fillStyle = '#9ca3af';     ctx.font = '12px sans-serif';     ctx.textAlign = 'right';     ctx.fillText(formatEuro(valeur), padding - 10, y + 4);   }      // Dessiner la courbe du total versÃ©   ctx.strokeStyle = '#7a6ff0';   ctx.lineWidth = 3;   ctx.beginPath();   dataPoints.forEach((point, i) => {     const x = padding + ((point.date.getTime() - minDate) / (maxDate - minDate)) * graphWidth;     const y = canvas.height - padding - (point.verse / maxValeur) * graphHeight;     if (i === 0) ctx.moveTo(x, y);     else ctx.lineTo(x, y);   });   ctx.stroke();      // Dessiner la courbe de la valeur   ctx.strokeStyle = '#39b46e';   ctx.lineWidth = 4;   ctx.beginPath();   dataPoints.forEach((point, i) => {     const x = padding + ((point.date.getTime() - minDate) / (maxDate - minDate)) * graphWidth;     const y = canvas.height - padding - (point.valeur / maxValeur) * graphHeight;     if (i === 0) ctx.moveTo(x, y);     else ctx.lineTo(x, y);   });   ctx.stroke();      // Points sur la courbe de valeur   dataPoints.forEach((point, i) => {     const x = padding + ((point.date.getTime() - minDate) / (maxDate - minDate)) * graphWidth;     const y = canvas.height - padding - (point.valeur / maxValeur) * graphHeight;     ctx.fillStyle = '#39b46e';     ctx.beginPath();     ctx.arc(x, y, 5, 0, Math.PI * 2);     ctx.fill();   });      // LÃ©gende   ctx.fillStyle = '#39b46e';   ctx.fillRect(padding + 20, 20, 20, 4);   ctx.fillStyle = '#e2e8f0';   ctx.font = 'bold 14px sans-serif';   ctx.textAlign = 'left';   ctx.fillText('Valeur du PEA', padding + 50, 25);      ctx.fillStyle = '#7a6ff0';   ctx.fillRect(padding + 200, 20, 20, 4);   ctx.fillStyle = '#e2e8f0';   ctx.fillText('Total versÃ©', padding + 230, 25); }  function simulerScenario() {   const investActuel = Number(document.getElementById('investissement').value) || 0;   const rendementActuel = Number(document.getElementById('rendement').value) / 100 || 0.07;   const ageActuel = Number(document.getElementById('age').value) || 17;   const livretA = Number(document.getElementById('livretA').value) || 0;   const compteCourant = Number(document.getElementById('compteCourant').value) || 0;      // Calcul capital actuel   const today = new Date();   let valeurPEAActuelle = 0;   let totalVerseActuel = 0;      historiqueMois.forEach(item => {     const depDate = new Date(item.date);     let monthsElapsed = (today.getFullYear() - depDate.getFullYear()) * 12 + (today.getMonth() - depDate.getMonth());     if (monthsElapsed < 0) monthsElapsed = 0;     const monthlyRate = rendementActuel / 12;     valeurPEAActuelle += item.montant * Math.pow(1 + monthlyRate, monthsElapsed);     totalVerseActuel += item.montant;   });      const capitalActuel = livretA + compteCourant + valeurPEAActuelle;      // ParamÃ¨tres simulation   const investSimule = Number(document.getElementById('simInvest').value) || 0;   const rendementSimule = Number(document.getElementById('simRendement').value) / 100 || 0.05;   const ageCible = Number(document.getElementById('simAge').value) || 45;      const annees = ageCible - ageActuel;   if (annees <= 0) {     alert('L\'Ã¢ge cible doit Ãªtre supÃ©rieur Ã  ton Ã¢ge actuel !');     return;   }      const mois = annees * 12;   const monthlyRateActuel = rendementActuel / 12;   const monthlyRateSimule = rendementSimule / 12;      // ScÃ©nario actuel   let capitalFinalActuel;   if (monthlyRateActuel === 0) {     capitalFinalActuel = capitalActuel + investActuel * mois;   } else {     capitalFinalActuel = capitalActuel * Math.pow(1 + monthlyRateActuel, mois) +                          investActuel * ((Math.pow(1 + monthlyRateActuel, mois) - 1) / monthlyRateActuel);   }      // ScÃ©nario simulÃ©   let capitalFinalSimule;   if (monthlyRateSimule === 0) {     capitalFinalSimule = capitalActuel + investSimule * mois;   } else {     capitalFinalSimule = capitalActuel * Math.pow(1 + monthlyRateSimule, mois) +                          investSimule * ((Math.pow(1 + monthlyRateSimule, mois) - 1) / monthlyRateSimule);   }      const difference = capitalFinalSimule - capitalFinalActuel;   const diffPct = ((difference / capitalFinalActuel) * 100).toFixed(1);      // Affichage   document.getElementById('resultatsSimulation').style.display = 'block';   document.getElementById('scenarioActuel').textContent = formatEuro(capitalFinalActuel);   document.getElementById('detailsActuel').textContent = `${investActuel}â‚¬/mois Â· ${(rendementActuel*100).toFixed(1)}% Â· ${annees} ans`;      document.getElementById('scenarioSimule').textContent = formatEuro(capitalFinalSimule);   document.getElementById('detailsSimule').textContent = `${investSimule}â‚¬/mois Â· ${(rendementSimule*100).toFixed(1)}% Â· ${annees} ans`;      const diffElement = document.getElementById('difference');   diffElement.textContent = (difference >= 0 ? '+ ' : '- ') + formatEuro(Math.abs(difference));   diffElement.style.color = difference >= 0 ? '#39b46e' : '#e53e3e';      document.getElementById('detailsDiff').textContent = (difference >= 0 ? '+' : '') + diffPct + '% par rapport au scÃ©nario actuel';   document.getElementById('detailsDiff').style.color = difference >= 0 ? '#39b46e' : '#e53e3e'; }  function ajouterMois() {   const dateStr = document.getElementById('nouvelleDate').value;   const montant = Number(document.getElementById('nouveauMontant').value) || 0;   if (!dateStr || montant <= 0) {     alert('âŒ Remplis correctement la date et le montant.');     return;   }   const msciWorldPct = (Number(document.getElementById('msciWorld').value) || 85) / 100;   const msciEMPct = (Number(document.getElementById('msciEM').value) || 15) / 100;    const obj = {     date: dateStr,     montant: montant,     world: Math.round(montant * msciWorldPct * 100) / 100,     em: Math.round(montant * msciEMPct * 100) / 100,     id: Date.now() + Math.floor(Math.random()*1000)   };    historiqueMois.push(obj);   historiqueMois.sort((a,b) => new Date(a.date) - new Date(b.date));   document.getElementById('nouvelleDate').value = '';   document.getElementById('nouveauMontant').value = montant;   calculer(); }  function supprimerMois(id) {   if (!confirm('Supprimer cet enregistrement ?')) return;   historiqueMois = historiqueMois.filter(m => Number(m.id) !== Number(id));   calculer(); }  function afficherHistorique() {   const tbody = document.getElementById('historique');   if (historiqueMois.length === 0) {     tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:#718096">Aucun investissement enregistrÃ©. Ajoute ton premier mois !</td></tr>';     return;   }    const rendement = Number(document.getElementById('rendement').value) / 100 || 0.07;   const today = new Date();   let valeurCumulee = 0;   let totalVerse = 0;   let html = '';    historiqueMois.forEach((item, index) => {     const depDate = new Date(item.date);     let monthsElapsed = (today.getFullYear() - depDate.getFullYear()) * 12 + (today.getMonth() - depDate.getMonth());     if (monthsElapsed < 0) monthsElapsed = 0;     const monthlyRate = rendement / 12;     const valueThis = item.montant * Math.pow(1 + monthlyRate, monthsElapsed);     valeurCumulee += valueThis;     totalVerse += item.montant;     const plusValue = valeurCumulee - totalVerse;     const dateFormatee = depDate.toLocaleDateString('fr-FR', { day: '2-digit', month:'long', year:'numeric' });      html += `       <tr>         <td>${dateFormatee}</td>         <td><strong>${formatEuro(item.montant)}</strong></td>         <td>${formatEuro(item.world)}</td>         <td>${formatEuro(item.em)}</td>         <td class="positive"><strong>${formatEuro(valeurCumulee)}</strong></td>         <td class="positive">${(plusValue>=0?'+':'')}${formatEuro(plusValue)}</td>         <td><button class="btn-delete" data-id="${item.id}" title="Supprimer">ğŸ—‘ï¸</button></td>       </tr>     `;   });    tbody.innerHTML = html; }  document.addEventListener('click', function(e) {   const t = e.target;   if (t && t.classList && t.classList.contains('btn-delete')) {     const id = t.getAttribute('data-id');     if (id) supprimerMois(id);   } });  function afficherProjection(capitalActuel, investissement, rendementAnn, ageActuel) {   const ages = [20,25,30,35,40,45];   const grid = document.getElementById('projectionGrid');   const tbody = document.getElementById('projectionBody');   grid.innerHTML = '';   tbody.innerHTML = '';    const monthlyRate = rendementAnn / 12;    ages.forEach(age => {     if (age <= ageActuel) return;     const years = age - ageActuel;     const months = years * 12;     let capitalFinal;     if (monthlyRate === 0) {       capitalFinal = capitalActuel + investissement * months;     } else {       capitalFinal = capitalActuel * Math.pow(1 + monthlyRate, months) +                      investissement * ( (Math.pow(1 + monthlyRate, months) - 1) / monthlyRate );     }     const totalVerse = capitalActuel + investissement * months;     const plusValue = capitalFinal - totalVerse;      const card = document.createElement('div');     card.className = 'projection-card';     card.innerHTML = `<div class="projection-age">${age} ans</div><div class="projection-amount">${formatEuro(capitalFinal)}</div>`;     grid.appendChild(card);      const tr = document.createElement('tr');     tr.innerHTML = `<td><strong>${age} ans</strong></td>                     <td>${years} an${years>1?'s':''}</td>                     <td>${formatEuro(totalVerse)}</td>                     <td class="positive"><strong>${formatEuro(capitalFinal)}</strong></td>                     <td class="positive">${(plusValue>=0?'+':'')}${formatEuro(plusValue)}</td>`;     tbody.appendChild(tr);   }); }  function formatEuro(valeur) {   if (valeur === null || valeur === undefined || isNaN(Number(valeur))) return '0 â‚¬';   return Math.round(Number(valeur)).toLocaleString('fr-FR') + ' â‚¬'; } </script> </body> </html>
